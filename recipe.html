<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Recipe | No Ads Recipes</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/htmx.org@1.9.2"></script>

  <!-- Placeholder for schema.org recipe data -->
  <script id="schema-recipe" type="application/ld+json"></script>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://zwpjebsbajckijqgwtnp.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp3cGplYnNiYWpja2lqcWd3dG5wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUxMDQ3ODksImV4cCI6MjA2MDY4MDc4OX0.bqFrMUOMCD0wh3l07y8axCl_SevNf86DfV8QBOEtrR8'
    );

    const params = new URLSearchParams(window.location.search);
    const slug = params.get("slug");

    const recipeContainer = document.getElementById("recipe-container");

    async function loadRecipe() {
      if (!slug) {
        recipeContainer.innerHTML = "<p class='text-red-600'>No recipe slug provided.</p>";
        return;
      }

      const { data, error } = await supabase
        .from("recipes")
        .select("*")
        .eq("slug", slug)
        .single();

      if (error || !data) {
        recipeContainer.innerHTML = "<p class='text-red-600'>Recipe not found.</p>";
        return;
      }

      // Render recipe HTML
      const { title, content, created_at } = data;
      const { ingredients = [], instructions = [] } = content || {};

      recipeContainer.innerHTML = `
        <h2 class="text-2xl font-bold mb-2">${title}</h2>
        <p class="text-gray-500 text-sm mb-6">Posted on ${new Date(created_at).toLocaleDateString()}</p>

        <h3 class="text-lg font-semibold mb-1">Ingredients</h3>
        <ul class="list-disc list-inside mb-6">
          ${ingredients.map(i => `<li>${i}</li>`).join("")}
        </ul>

        <h3 class="text-lg font-semibold mb-1">Instructions</h3>
        <ol class="list-decimal list-inside space-y-2">
          ${instructions.map(i => `<li>${i}</li>`).join("")}
        </ol>
      `;

      // Inject schema.org Recipe JSON-LD
      const structuredData = {
        "@context": "https://schema.org/",
        "@type": "Recipe",
        "name": title,
        "author": {
          "@type": "Organization",
          "name": "No Ads Recipes"
        },
        "datePublished": created_at,
        "recipeIngredient": ingredients,
        "recipeInstructions": instructions,
        "description": "Recipe from No Ads Recipes"
      };

      document.getElementById("schema-recipe").textContent = JSON.stringify(structuredData, null, 2);
    }

    loadRecipe();
  </script>
</head>
<body class="text-gray-800 font-sans bg-gray-50">

  <!-- Header -->
  <div hx-get="header.html" hx-trigger="load"></div>

  <!-- Page Content -->
  <main class="p-4 max-w-2xl mx-auto">
    <a href="./" class="text-blue-600 hover:underline mb-6 inline-block">&larr; Back to all recipes</a>
    <div id="recipe-container" class="bg-white p-6 rounded shadow-sm">
      <!-- Recipe content loads here -->
    </div>
  </main>

  <!-- Footer -->
  <div hx-get="footer.html" hx-trigger="load"></div>

</body>
</html>
